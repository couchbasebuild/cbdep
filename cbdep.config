---
packages:
  java:
    - if_platform: [linux, windows, macosx]
      actions:
        - url: http://nas-n.mgt.couchbase.com/builds/downloads/jdk/jdk-${VERSION}-${PLATFORM}-x64.tar.gz
        - unarchive:

  # Python: We use pyenv on Linux and MacOS to support building various
  # versions of Python. On Windows we download the pre-built installers
  # from python.org.
  # For Python >= 3.3, we then create a venv in the specified "install"
  # directory. For Python 2.7.x we instead create a virtualenv.
  # We don't support Python 3.0-3.2.x which didn't have venv.
  # We don't support Python 2.7.x on Windows. Those installers were
  # provided as an MSI so we'd need a different install command here.
  python:
    - if_platform: [linux, macos]
      if_version: ">= 3.3"
      actions:
        - run: |
            git clone git://github.com/pyenv/pyenv.git ${HOME}/.pyenv 2>/dev/null || true
            cd ${HOME}/.pyenv && git pull
            ${HOME}/.pyenv/bin/pyenv install ${VERSION}
          fixed_dir: ${HOME}/.pyenv/versions/${VERSION}
        - run: |
            ${FIXED_DIR}/bin/python -m venv ${INSTALL_DIR}/python${VERSION}

    - if_platform: [linux, macos]
      if_version: ">= 2.7, < 3.0"
      actions:
        - run: |
            git clone git://github.com/pyenv/pyenv.git ${HOME}/.pyenv 2>/dev/null || true
            cd ${HOME}/.pyenv && git pull
            ${HOME}/.pyenv/bin/pyenv install ${VERSION}
            ${FIXED_DIR}/bin/python -m pip install virtualenv
          fixed_dir: ${HOME}/.pyenv/versions/${VERSION}
        - run: |
            ${FIXED_DIR}/bin/python -m virtualenv ${INSTALL_DIR}/python${VERSION}

    - if_platform: [windows]
      if_version: ">= 3.3"
      actions:
        - url: https://www.python.org/ftp/python/${VERSION}/python-${VERSION}-amd64.exe
        - run: start /wait ${DL} /quiet Include_doc=0 Include_launcher=0 Include_tcltk=0 Shortcuts=0 TargetDir=${FIXED_DIR}
          fixed_dir: C:\Python${VERSION}
        - run: |
            ${FIXED_DIR}\python.exe -m venv ${INSTALL_DIR}\python${VERSION}

  golang:
    - if_platform: [linux, darwin]
      actions:
        - url: https://dl.google.com/go/go${VERSION}.${PLATFORM}-amd64.tar.gz
        - unarchive:
    - if_platform: windows
      actions:
        - url: https://dl.google.com/go/go${VERSION}.windows-amd64.zip
        - unarchive:

  # .NET Core (SDK and Runtime) - download URLs are the same for all versions
  # on MacOS and Windows. However on Linux, the URLs for .NET Core 1.x are
  # more specific and name explicit Linux distros. Therefore we need three
  # different blocks here per package - one for all versions on Windows/MacOS,
  # one for .NET Core 2.x on "linux", and one for .NET Core 1.x on specific
  # linux distros.
  dotnet-core-sdk:
    - if_platform: [windows, macos]
      actions:
        - url: https://www.microsoft.com/net/download/thank-you/dotnet-sdk-${VERSION}-${PLATFORM}-x64-binaries
          scrape_html: window.open\("(.*?)"
        - unarchive:
          add_dir: dotnet-core-sdk-${VERSION}

    - if_platform: [linux]
      if_version: ">= 2.0"
      actions:
        - url: https://www.microsoft.com/net/download/thank-you/dotnet-sdk-${VERSION}-${PLATFORM}-x64-binaries
          scrape_html: window.open\("(.*?)"
        - unarchive:
          add_dir: dotnet-core-sdk-${VERSION}

    - if_platform: [ubuntu-16.04, ubuntu-14.04, centos, debian]
      if_version: ">= 1.0, < 2.0"
      actions:
        - url: https://www.microsoft.com/net/download/thank-you/dotnet-sdk-${VERSION}-linux-${PLATFORM}-x64-binaries
          scrape_html: window.open\("(.*?)"
        - unarchive:
          add_dir: dotnet-core-sdk-${VERSION}

  dotnet-core-runtime:
    - if_platform: [windows, macos]
      actions:
        - url: https://www.microsoft.com/net/download/thank-you/dotnet-runtime-${VERSION}-${PLATFORM}-x64-binaries
          scrape_html: window.open\("(.*?)"
        - unarchive:
          add_dir: dotnet-core-runtime-${VERSION}

    - if_platform: [linux]
      if_version: ">= 2.0"
      actions:
        - url: https://www.microsoft.com/net/download/thank-you/dotnet-runtime-${VERSION}-${PLATFORM}-x64-binaries
          scrape_html: window.open\("(.*?)"
        - unarchive:
          add_dir: dotnet-core-runtime-${VERSION}

    - if_platform: [ubuntu-16.04, ubuntu-14.04, centos, debian]
      if_version: ">= 1.0, < 2.0"
      actions:
        - url: https://www.microsoft.com/net/download/thank-you/dotnet-runtime-${VERSION}-linux-${PLATFORM}-x64-binaries
          scrape_html: window.open\("(.*?)"
        - unarchive:
          add_dir: dotnet-core-runtime-${VERSION}

  docker:
    - if_platform: [linux, mac]
      actions:
        - url: https://download.docker.com/${PLATFORM}/static/stable/x86_64/docker-${VERSION}-ce.tgz
        - unarchive:

  nodejs:
    - if_platform: [linux, darwin]
      actions:
        - url: https://nodejs.org/dist/v${VERSION}/node-v${VERSION}-${PLATFORM}-x64.tar.xz
        - unarchive:

    - if_platform: [windows]
      actions:
        - url: https://nodejs.org/dist/v${VERSION}/node-v${VERSION}-win-x64.zip
        - unarchive:
